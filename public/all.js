function AuthFactory(a,b,c,d){var e={};return e.login=function(b,d){return a.post("/api/token",{username:b,password:d}).then(function(a){var b=a.data;if(b.token)return c.setToken(a.data.token),b;throw b.message})},e.logout=function(){d.get("$http").remove("/api/me/"),c.setToken()},e.loggedIn=function(){return!!c.getToken()},e.getUser=function(){return e.loggedIn()?a.get("/api/me/",{cache:!0}):b.reject({message:"User has no token."})},e}function AuthTokenFactory(a){var b={};return b.getToken=function(){return a.localStorage.getItem("token")},b.setToken=function(b){b?a.localStorage.setItem("token",b):a.localStorage.removeItem("token")},b}function AuthInterceptorFactory(a,b,c){var d={};return d.request=function(a){var b=c.getToken();return b&&(a.headers["x-access-token"]=b),a},d.responseError=function(d){return 403==d.status&&(c.setToken(),b.get("$state").go("login")),a.reject(d)},d}angular.module("nhs",["ui.router","ui.bootstrap","nhs.auth"]).config(["$httpProvider",function(a){a.interceptors.push("AuthInterceptor")}]),angular.module("nhs").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/login"),a.state("login",{url:"/login",templateUrl:"templates/login.html",controller:"login"}).state("dashboard",{url:"/dashboard",templateUrl:"templates/dashboard.html",controller:"dashboard"}).state("event",{url:"/event",template:"<div ui-view></div>",abstract:!0}).state("event.create",{url:"/create",templateUrl:"templates/event.html",controller:"eventCreate"}).state("event.edit",{url:"/edit/:eventID",templateUrl:"templates/event.html",controller:"eventEdit"}).state("uevent",{url:"/upcoming-event",template:"<div ui-view></div>",abstract:!0}).state("uevent.create",{url:"/create",templateUrl:"templates/uevent.html",controller:"upcomingEventCreate"}).state("uevent.edit",{url:"/edit/:ueventID"}).state("memberList",{url:"/members/",templateUrl:"templates/members.html",controller:"memberList"}).state("singleMember",{url:"/member/:memberID",templateUrl:"templates/single-member.html",controller:"singleMember"})}]),angular.module("nhs.auth",[]).factory("Auth",["$http","$q","AuthToken","$cacheFactory",AuthFactory]).factory("AuthToken",["$window",AuthTokenFactory]).factory("AuthInterceptor",["$q","$injector","AuthToken",AuthInterceptorFactory]),angular.module("nhs").factory("Event",["$http","$rootScope","Auth",function(a,b,c){var d=b.user.id,e="/api/users/"+d+"/events/",f={};return f.all=function(){return a.get(e).then(function(a){return a.data})},f.create=function(b){return a.post(e,b)},f.get=function(b){return a.get(e+b).then(function(a){return a.data})},f.update=function(b,c){return a.put(e+b,c)},f.delete=function(b){return a.delete(e+b)},f}]).factory("UpcomingEvent",["$http","$rootScope","Auth",function(a,b,c){var d="/api/upcoming-events/",e={};return e.all=function(){return a.get(d).then(function(a){return a.data})},e.create=function(b){return a.post(d,b)},e.get=function(b){return a.get(d+b).then(function(a){return a.data})},e.update=function(b,c){return a.put(d+b,c)},e.delete=function(b){return a.delete(d+b)},e}]),angular.module("nhs").factory("User",["$http","$rootScope","Auth",function(a,b,c){var d="/api/users/",e={};return e.all=function(){return a.get(d).then(function(a){return a.data})},e.create=function(b){return a.post(d,b)},e.get=function(b){return a.get(d+b).then(function(a){return a.data})},e.getEvents=function(b){return a.get(d+b+"/events").then(function(a){return a.data})},e.checkEvent=function(b,c){return a.post(d+b+"/events/"+c+"/check").then(function(a){return a.data})},e.update=function(b,c){return a.put(d+b,c)},e.delete=function(b){return a.delete(d+b)},e}]),angular.module("nhs").run(function(a,b){b.state=a}).controller("main",["$scope","$rootScope","$state","Auth",function(a,b,c,d){b.user=b.user||{},a.getState=function(){return c.current.name},b.$on("$stateChangeStart",function(a,e,f,g,h,i){d.getUser().then(function(a){b.user=a.data,b.user.loggedIn=!0}).catch(function(a){"login"!==e.name&&c.go("login")})}),a.logout=function(){d.logout(),b.user={},b.user.loggedIn=!1,c.go("login")}}]),angular.module("nhs").controller("login",["$scope","$state","$rootScope","Auth",function(a,b,c,d){a.processing=!1,c.user.loggedIn&&b.go("dashboard"),a.login=function(){a.processing=!0,d.login(a.user.username.toLowerCase(),a.user.password).then(function(a){c.user=a,b.go("dashboard")}).catch(function(b){a.error=b})}}]),angular.module("nhs").controller("dashboard",["$scope","$state","$rootScope","Event","UpcomingEvent","$timeout",function(a,b,c,d,e,f){a.events=[],d.all().then(function(b){a.events=b}),e.all().then(function(a){c.upcoming=a}),a.removeEvent=function(b,c){d.delete(b).then(function(){a.events.splice(c,1)})},a.findTotal=function(){for(var b=0,c=0;c<a.events.length;c++)b+=a.events[c].hours;return b}}]),angular.module("nhs").controller("eventCreate",["$scope","$state","$rootScope","Event",function(a,b,c,d){a.saveEvent=function(){d.create(a.eventData).then(function(){b.go("dashboard")})},a.setUEvent=function(b){a.eventData.date=b.date}}]).controller("eventEdit",["$scope","$state","$rootScope","$stateParams","Event",function(a,b,c,d,e){var f=d.eventID;e.get(f).then(function(b){a.eventData=b}),a.saveEvent=function(){e.update(f,a.eventData).then(function(){b.go("dashboard")})},a.setUEvent=function(b){a.eventData.date=b.date}}]).controller("upcomingEventCreate",["$scope","$state","$rootScope","$stateParams","UpcomingEvent",function(a,b,c,d,e){a.saveEvent=function(){e.create(a.eventData).then(function(){b.go("dashboard")})}}]),angular.module("nhs").controller("memberList",["$scope","$state","$rootScope","User",function(a,b,c,d){d.all().then(function(b){a.members=b})}]).controller("singleMember",["$scope","$stateParams","$rootScope","User","$q","$state",function(a,b,c,d,e,f){a.events=[],d.get(b.memberID).then(function(b){a.member=b}),d.getEvents(b.memberID).then(function(b){a.events=b}),a.findTotal=function(){for(var b=0,c=0;c<a.events.length;c++)b+=a.events[c].hours;return b},a.saveChecks=function(){var c=[];angular.forEach(a.events,function(a){a.justChecked&&c.push(d.checkEvent(b.memberID,a._id))}),e.all(c).then(function(){f.go("memberList")})}}]);